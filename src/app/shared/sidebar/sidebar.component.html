<aside class="sidebar-container" [class.collapsed]="isCollapsed()">
    <button class="toggle-btn" (click)="toggleSidebar()">
        {{ isCollapsed() ? '»' : '«' }}
    </button>

    <div class="sidebar-content">
        <!-- Arcade Mode Control Panel -->
        @if (isArcadeMode() && !isCollapsed()) {
        <app-arcade-controls [arcadeProps]="arcadeProps()" [arcadeChaos]="arcadeChaos()"
            (chaosChanged)="onChaosChanged($event)" (presetApplied)="onPresetApplied($event)"
            (propertyToggled)="onPropertyToggled($event)" (effectToggled)="onEffectToggled($event)"
            (miniGameStarted)="onMiniGameStarted()" (menuRequested)="goToMenu()">
        </app-arcade-controls>
        }

        <!-- History Mode: Chaos Meter + Chat Area -->
        @if (!isArcadeMode() && !isCollapsed()) {
        <app-chaos-meter [chaosLevel]="gameState().chaosLevel"></app-chaos-meter>

        <app-chat-area #chatAreaComp [dialogueHistory]="dialogueHistory()" [currentNode]="currentNode()"
            [isAskingName]="isAskingName()" [isMobile]="isMobile()" (dialogueAdvanced)="onDialogueAdvanced()"
            (optionSelected)="onOptionSelected($event)" (playerNameSubmitted)="onPlayerNameSubmitted($event)"
            (menuRequested)="goToMenu()" (settingsToggled)="onSliderToggled()">
        </app-chat-area>
        }

        <div class="spacer"></div>

        <!-- Music Controls + Save Button -->
        @if (!isCollapsed() || (isMobile() && showVolumeSlider())) {
        <app-music-controls [volume]="volume()" [isMuted]="isMuted()" [showVolumeSlider]="showVolumeSlider()"
            [isMobile]="isMobile()" (volumeChanged)="onVolumeChanged($event)" (muteToggled)="onMuteToggled()"
            (sliderToggled)="onSliderToggled()" (saveRequested)="onSaveRequested()">
        </app-music-controls>
        }
    </div>
</aside>